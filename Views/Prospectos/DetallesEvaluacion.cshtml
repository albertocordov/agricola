@model AgricolaProspectos.Models.Prospecto

@{
    ViewData["Title"] = "Evaluar prospecto";
}

<h1>Evaluar prospecto</h1>

<div>
    <form asp-action="Evaluar" method="post">

        <dl class="row">
            <dt class="col-sm-2">
                @Html.DisplayNameFor(model => model.Nombre)
            </dt>
            <dd class="col-sm-10">
                @Html.DisplayFor(model => model.Nombre)
            </dd>
            <dt class="col-sm-2">
                Primer apellido
            </dt>
            <dd class="col-sm-10">
                @Html.DisplayFor(model => model.PrimerApellido)
            </dd>
            <dt class="col-sm-2">
                Segundo apellido
            </dt>
            <dd class="col-sm-10">
                @Html.DisplayFor(model => model.SegundoApellido)
            </dd>
            <dt class="col-sm-2">
                @Html.DisplayNameFor(model => model.Calle)
            </dt>
            <dd class="col-sm-10">
                @Html.DisplayFor(model => model.Calle)
            </dd>
            <dt class="col-sm-2">
                Número
            </dt>
            <dd class="col-sm-10">
                @Html.DisplayFor(model => model.Numero)
            </dd>
            <dt class="col-sm-2">
                @Html.DisplayNameFor(model => model.Colonia)
            </dt>
            <dd class="col-sm-10">
                @Html.DisplayFor(model => model.Colonia)
            </dd>
            <dt class="col-sm-2">
                Código postal
            </dt>
            <dd class="col-sm-10">
                @Html.DisplayFor(model => model.CodigoPostal)
            </dd>
            <dt class="col-sm-2">
                Teléfono
            </dt>
            <dd class="col-sm-10">
                @Html.DisplayFor(model => model.Telefono)
            </dd>
            <dt class="col-sm-2">
                RFC
            </dt>
            <dd class="col-sm-10">
                @Html.DisplayFor(model => model.Rfc)
            </dd>
            <dt class="col-sm-2">
                @Html.DisplayNameFor(model => model.Estatus)
            </dt>
            <dd class="col-sm-10">
                @Html.DisplayFor(model => model.Estatus)
            </dd>

            <div class="form-group">
                @Html.HiddenFor(model => model.ProspectoId)

                <label for="dictamen">Dictamen</label>
                <select class="form-control" id="dictamen" name="dictamen">
                    <option>Autorizado</option>
                    <option>Rechazado</option>  
                </select>
            </div>
            <div class="form-group" id="observacionesGroup">
                <label for="observaciones">Observaciones</label>
                <textarea class="form-control" id="observaciones" name="observaciones" rows="3">SIN DATOS</textarea>
            </div>
        </dl>

        <br>
        <div class="form-group">
            <input type="submit" value="Evaluar" class="btn btn-primary" />
        </div>
    </form>
</div>

<br>
<div>
    <a asp-action="Index">Regresar</a>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            function toggleObservaciones() {
                var dictamen = $("#dictamen").val();
                
                if (dictamen === "Rechazado") {
                    $("#observaciones").val("");
                    $("#observacionesGroup").show();
                } else {
                    $("#observacionesGroup").hide();
                    $("#observaciones").val("SIN DATOS");
                }
            }

            toggleObservaciones();

            $("#dictamen").change(function () {
                toggleObservaciones();
            });

            $("form").submit(function (event) {
                event.preventDefault();

                var prospectoId = $("#ProspectoId").val();
                var dictamen = $("#dictamen").val();
                var observaciones = $("#observaciones").val();

                Swal.fire({
                    icon: 'success',
                    title: 'Prospecto evaluado correctamente',
                    showConfirmButton: true,
                    didOpen: () => {
                        Swal.stopTimer();
                    },
                    preConfirm: () => {
                        window.location.href = '@Url.Action("Index", "Prospectos")';
                    }
                });
            });
        });
    </script>
}
